<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>木薯叔天然木薯貓砂</title>

  <!-- Snipcart CSS -->
  <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.3.0/default/snipcart.css" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main>
    <h2>產品介紹</h2>
    <div class="product">
      <h3>木薯叔天然木薯貓砂</h3>
      <p>天然無添加木薯貓砂，清爽不黏底，適合過敏貓</p>

      <div class="quantity-container">
        <button class="quantity-button" onclick="decreaseQuantity()">−</button>
        <input id="product-quantity" type="number" value="1" min="1" />
        <button class="quantity-button" onclick="increaseQuantity()">＋</button>
      </div>

      <button
        class="snipcart-add-item custom-cart-button"
        data-item-id="cassava-sand"
        data-item-name="木薯叔天然木薯貓砂"
        data-item-price="250"
        data-item-url="index.html"
        data-item-description="天然無添加木薯貓砂，清爽不黏底，適合過敏貓"
        data-item-quantity="1"
        onclick="updateQuantity()"
      >
        加入購物車
      </button>
    </div>
  </main>

  <!-- 浮動購物欄 HTML -->
  <div class="floating-cart-bar" id="floatingCartBar">
    <a href="#" class="snipcart-checkout">
      🛒 購物車：<span class="snipcart-items-count"></span> 件 – NT$<span class="snipcart-total-price"></span>
    </a>
  </div>

  <!-- Snipcart Script -->
  <script async src="https://cdn.snipcart.com/themes/v3.3.0/default/snipcart.js"></script>

  <!-- Snipcart Container -->
  <div hidden id="snipcart" data-api-key="MDJhYTU3MzEtM2U3Ni00NmNiLTgzODUtYWEzNTI1MmFmYjVmNjM4ODQ0Njc2MTc2MzY4ODA5"></div>

  <!-- 功能腳本 -->
  <script>
    function increaseQuantity() {
      const input = document.getElementById("product-quantity");
      input.value = parseInt(input.value) + 1;
    }

    function decreaseQuantity() {
      const input = document.getElementById("product-quantity");
      if (parseInt(input.value) > 1) {
        input.value = parseInt(input.value) - 1;
      }
    }

    function updateQuantity() {
      const quantity = document.getElementById("product-quantity").value;
      const button = document.querySelector(".snipcart-add-item");
      button.setAttribute("data-item-quantity", quantity);
    }

    // 浮動欄位出現/消失功能
    let lastScrollY = window.scrollY;
    const cartBar = document.getElementById("floatingCartBar");

    window.addEventListener("scroll", () => {
      const currentScrollY = window.scrollY;

      if (currentScrollY > lastScrollY) {
        cartBar.classList.add("show");
      } else {
        cartBar.classList.remove("show");
      }

      lastScrollY = currentScrollY;
    });

    // 同步購物車數量與金額
    document.addEventListener('snipcart.ready', () => {
      const cartCount = document.querySelector('.snipcart-items-count');
      const cartTotal = document.querySelector('.snipcart-total-price');

      Snipcart.store.subscribe(() => {
        const state = Snipcart.store.getState();
        const items = state.cart.items;
        const total = state.cart.total;

        const quantity = items.reduce((sum, item) => sum + item.quantity, 0);
        cartCount.textContent = quantity;
        cartTotal.textContent = Math.round(total);
      });
    });
  </script>
</body>
</html>
